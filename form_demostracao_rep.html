<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solicitação de Demostrações</title>
    <style>
    body {
        font-family: 'Segoe UI', Arial, sans-serif;
        background: #f6f8fa;
        margin: 0;
        padding: 0;
    }

    form {
        background: #fff;
        max-width: 480px;
        margin: 40px auto;
        padding: 32px 28px 24px 28px;
        border-radius: 12px;
        box-shadow: 0 4px 24px rgba(0,0,0,0.08);
        display: flex;
        flex-direction: column;
        gap: 18px;
    }

    .form-group {
        display: flex;
        flex-direction: column;
        gap: 6px;
    }

    label {
        font-weight: 500;
        color: #22223b;
    }

    input[type="text"],
    input[type="number"],
    select {
        width: 96%;
        padding: 8px 10px;
        border: 1px solid #c9c9c9;
        border-radius: 6px;
        font-size: 1rem;
        background: #f8fafc;
        transition: border 0.2s;
    }

    input[type="text"]:focus,
    input[type="number"]:focus,
    select:focus {
        border-color: #4f8cff;
        outline: none;
        background: #fff;
    }

    #produtos-container {
        margin-bottom: 0;
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .produto-label-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 4px;
    }

    .produto-row {
        display: flex;
        gap: 12px;
        align-items: center;
    }

    button[type="button"]#add-produto {
        background: #4f8cff;
        color: #fff;
        border: none;
        border-radius: 50%;
        width: 32px;
        height: 32px;
        font-size: 1.3rem;
        cursor: pointer;
        transition: background 0.2s;
        vertical-align: middle;
        margin-left: 6px;
    }

    button[type="button"]#add-produto:disabled {
        background: #bfc9d1;
        cursor: not-allowed;
    }

    .remove-produto-btn {
        background: #ff4f4f;
        color: #fff;
        border: none;
        border-radius: 50%;
        width: 32px;
        height: 32px;
        font-size: 1.3rem;
        cursor: pointer;
        margin-left: 4px;
        transition: background 0.2s;
    }

    button[type="submit"] {
        background: #22223b;
        color: #fff;
        border: none;
        border-radius: 6px;
        padding: 10px 28px;
        font-size: 1rem;
        font-weight: 500;
        cursor: pointer;
        margin-top: 10px;
        transition: background 0.2s;
        align-self: flex-end;
    }

    button[type="submit"]:hover {
        background: #4f8cff;
    }
    input[type="date"] {
        width: 96%;
        padding: 8px 10px;
        border: 1px solid #c9c9c9;
        border-radius: 6px;
        font-size: 1rem;
        background: #f8fafc;
        transition: border 0.2s;
        color: #22223b;
    }

    input[type="date"]:focus {
        border-color: #4f8cff;
        outline: none;
        background: #fff;
    }

    .clausulas-texto {
        font-size: 1rem;
        color: #22223b;
        margin-bottom: 18px;
    }
    .clausulas-texto p {
        margin: 0 0 14px 0;
        text-indent: 1.5em;
        line-height: 1.6;
        text-align: justify;
    }
    .clausula-num {
        font-weight: 600;
        margin-left: 0;
        text-indent: 0;
    }
    .clausula-sub {
        display: inline-block;
        width: 2em;
        margin-left: 2em;
        font-weight: 500;
    }
    </style>
</head>
<body>
    <form>
        <h2>Representante</h2>
        <div class="form-group">
            <label for="empresa">Empresa:</label>
            <input type="text" id="empresa" name="empresa" required>
        </div>

        <div class="form-group">
            <label for="representante">Representante:</label>
            <input type="text" id="representante" name="representante" required>
        </div>

        <div class="form-group">
            <label for="documento">CNPJ/CPF:</label>
            <input type="text" id="documento" name="documento" required pattern="\d{3}\.?\d{3}\.?\d{3}-?\d{2}|\d{2}\.?\d{3}\.?\d{3}/?\d{4}-?\d{2}" title="Digite um CPF (000.000.000-00) ou CNPJ (00.000.000/0000-00) válido" maxlength="18" oninput="formatarDocumento(this)">
        </div>

        <div class="form-group">
            <label for="cliente_cep">CEP:</label>
            <input type="text" id="cliente_cep" name="cliente_cep" required pattern="\d{5}-?\d{3}" maxlength="9" oninput="formatarCEP(this)">
        </div>
        <div class="form-group" style="flex-direction: row; gap: 12px; align-items: flex-end;">
            <div style="flex: 2; display: flex; flex-direction: column;">
                <label for="cliente_endereco">Endereço:</label>
                <input type="text" id="cliente_endereco" name="cliente_endereco" required style="width: 90%;">
            </div>
            <div style="flex: 1; display: flex; flex-direction: column;">
                <label for="cliente_numero">Número:</label>
                <input type="text" id="cliente_numero" name="cliente_numero" required style="width: 88%;"> 
            </div>
        </div>

        <div class="form-group">
            <label for="cliente_bairro">Bairro:</label>
            <input type="text" id="cliente_bairro" name="cliente_bairro" required>
        </div>
        <div class="form-group" style="flex-direction: row; gap: 12px; align-items: flex-end;">
             <div style="flex: 2; display: flex; flex-direction: column;">
                 <label for="cliente_cidade">Cidade:</label>
                 <input type="text" id="cliente_cidade" name="cliente_cidade" required style="width: 90%;">
             </div>
             <div style="flex: 1; display: flex; flex-direction: column;">
                 <label for="cliente_uf">UF:</label>
                 <input type="text" id="cliente_uf" name="cliente_uf" maxlength="2" required style="width: 88%;">
              </div>
        </div>

        <div class="form-group">
            <div class="produto-label-row">
                <label>Produto(s) Emprestado(s):</label>
                <button type="button" id="add-produto" title="Adicionar produto">+</button>
            </div>
            <div id="produtos-container">
                <div class="produto-row">
                    <select name="produto[]" required style="width: 370px;">
                        <option value="">Selecione um produto</option>
                        <option value="notebook">Notebook</option>
                        <option value="projetor">Projetor</option>
                        <option value="tablet">Tablet</option>
                        <option value="impressora">Impressora</option>
                    </select>
                    <input type="number" name="quantidade[]" min="1" max="99" value="1" required style="width:30px;">
                </div>
            </div>
        </div>

        <div class="form-group">
            <label for="valor_unitario">Valor Unitário:</label>
            <input type="number" id="valor_unitario" name="valor_unitario" min="0" step="0.01" required>
        </div>

        <div class="form-group">
            <label for="data_devolucao">Prazo de Devolução:</label>
            <input type="date" id="data_devolucao" name="data_devolucao" required>
        </div>

        <button type="submit">Enviar</button>
        <!-- Modal -->
        <div id="modal-clausulas" style="display:none; position:fixed; z-index:1000; left:0; top:0; width:100vw; height:100vh; background:rgba(34,34,59,0.25); align-items:center; justify-content:center;">
            <div style="background:#fff; border-radius:10px; max-width:560px; width:100%; padding:32px 24px 20px 24px; box-shadow:0 8px 32px rgba(0,0,0,0.18); position:relative;">
                <h2 style="margin-top:0; color:#22223b; font-size:1.2rem;">Cláusulas e Responsabilidades</h2>
                <div class="clausulas-texto">
                    <p>
                        <span class="clausula-num">I.</span> <strong>Representante</strong> se compromete a devolver o(s) produto(s) em perfeito estado, dentro do prazo máximo de <strong>60 dias</strong>, a contar da data de emissão da Nota fiscal.
                        <br>
                        <span class="clausula-sub">a)</span> Em caso de atraso na devolução, o <strong>Representante</strong> pagará uma multa de 0,33% do valor do produto por dia de atraso.
                    </p>
                    <p>
                        <span class="clausula-num">II.</span> Caso o produto seja instalado em um cliente final, o <strong>Representante</strong> deve:
                        <br>
                        <span class="clausula-sub">a) </span> Obter um <strong>Termo de Recebimento assinado pelo cliente</strong> em caso de demonstração para instalação no cliente.<br>
                        <span class="clausula-sub">b) </span> Informar a empresa sobre a instalação, fornecendo os dados do cliente e o prazo estimado para retirada.<br>
                        <span class="clausula-sub">c) </span> Assumir total responsabilidade pela recuperação do produto.
                    </p>
                    <p>
                        <span class="clausula-num">III.</span> Em caso de deterioração, perda ou não devolução do produto, o <strong>Representante</strong> será responsável pelo pagamento do valor integral do produto, incluindo ICMS e outros tributos (exceto em Amostras de Demonstração instaladas no cliente, este deverá ser ressarcido pelo próprio cliente).
                    </p>
                    <p>
                        <span class="clausula-num">IV.</span> A empresa reserva-se o direito de bloquear novas solicitações de peças de demonstração até a regularização de pendências.
                    </p>
                </div>
                <label style="display:flex; align-items:center; gap:8px; margin-bottom:12px;">
                    <input type="checkbox" id="concordo-checkbox">
                    Eu concordo
                </label>
                <div style="display:flex; justify-content:flex-end; gap:8px;"></div>
                    <button type="button" id="fechar-modal" style="background:#bfc9d1; color:#22223b; border:none; border-radius:6px; padding:8px 20px; font-size:1rem; font-weight:500; cursor:pointer; min-width:90px; transition:opacity 0.2s, visibility 0.2s;">Cancelar</button>
                    <button type="submit" id="enviar-btn" style="background:#22223b; color:#fff; border:none; border-radius:6px; padding:8px 20px; font-size:1rem; font-weight:500; cursor:pointer; min-width:90px; display:none;">Enviar</button>
                </div>
            </div>
        </div>
    </form>
</body>

<!--
    <button type="button" id="abrir-modal" style="margin-bottom:12px;">Exibir Cláusulas</button>
    <script>
        document.getElementById('abrir-modal').addEventListener('click', function() {
            document.getElementById('modal-clausulas').style.display = 'flex';
        });
    </script>
-->

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const dataInput = document.getElementById('data_devolucao');
        const today = new Date();
        const maxDate = new Date();
        maxDate.setDate(today.getDate() + 60);
        function formatDate(date) {
            const y = date.getFullYear();
            const m = String(date.getMonth() + 1).padStart(2, '0');
            const d = String(date.getDate()).padStart(2, '0');
            return `${y}-${m}-${d}`;
        }
        dataInput.min = formatDate(today);
        dataInput.max = formatDate(maxDate);
    });

    function formatarCEP(input) {
        let v = input.value.replace(/\D/g, '');
        if (v.length > 5) v = v.replace(/^(\d{5})(\d)/, '$1-$2');
        input.value = v;
    }

    document.getElementById('cliente_cep').addEventListener('blur', function() {
        const cep = this.value.replace(/\D/g, '');
        if (cep.length === 8) {
            fetch(`https://viacep.com.br/ws/${cep}/json/`)
                .then(response => response.json())
                .then(data => {
                    if (!data.erro) {
                        document.getElementById('cliente_endereco').value = data.logradouro || '';
                        document.getElementById('cliente_bairro').value = data.bairro || '';
                        document.getElementById('cliente_cidade').value = data.localidade || '';
                        document.getElementById('cliente_uf').value = data.uf || '';
                    }
                });
        }
    });

    function formatarDocumento(input) {
        let v = input.value.replace(/\D/g, '');
        if (v.length <= 11) {
            // CPF: 000.000.000-00
            v = v.replace(/(\d{3})(\d)/, '$1.$2');
            v = v.replace(/(\d{3})(\d)/, '$1.$2');
            v = v.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
        } else {
            // CNPJ: 00.000.000/0000-00
            v = v.replace(/^(\d{2})(\d)/, '$1.$2');
            v = v.replace(/^(\d{2})\.(\d{3})(\d)/, '$1.$2.$3');
            v = v.replace(/\.(\d{3})(\d)/, '.$1/$2');
            v = v.replace(/(\d{4})(\d{1,2})$/, '$1-$2');
        }
        input.value = v;
    }

    const form = document.querySelector('form');
    const modal = document.getElementById('modal-clausulas');
    const concordo = document.getElementById('concordo-checkbox');
    const enviarBtn = document.getElementById('enviar-btn');
    const fecharModal = document.getElementById('fechar-modal');
    let submitAllowed = false;

    form.addEventListener('submit', function(e) {
        if (!submitAllowed) {
            e.preventDefault();
            modal.style.display = 'flex';
            concordo.checked = false;
            enviarBtn.style.display = 'none';
        }
    });

    concordo.addEventListener('change', function() {
        enviarBtn.style.display = this.checked ? 'inline-block' : 'none';
    });

    fecharModal.addEventListener('click', function() {
        modal.style.display = 'none';
    });

    enviarBtn.addEventListener('click', function() {
        submitAllowed = true;
        modal.style.display = 'none';
        form.requestSubmit();
        submitAllowed = false;
    });

    // Fechar modal ao clicar fora da caixa
    modal.addEventListener('click', function(e) {
        if (e.target === modal) modal.style.display = 'none';
    });

    function addRemoveButton(row) {
        const removeBtn = document.createElement('button');
        removeBtn.type = 'button';
        removeBtn.textContent = '−';
        removeBtn.className = 'remove-produto-btn';
        removeBtn.title = 'Remover produto';
        removeBtn.addEventListener('click', function() {
            row.remove();
            const addBtn = document.getElementById('add-produto');
            addBtn.disabled = false;
        });
        row.appendChild(removeBtn);
    }

    document.querySelectorAll('.produto-row').forEach(addRemoveButton);
    const maxProdutos = 5;
    const produtosContainer = document.getElementById('produtos-container');
    const addBtn = document.getElementById('add-produto');
    addBtn.addEventListener('click', function() {
        const rows = produtosContainer.querySelectorAll('.produto-row');
        if (rows.length >= maxProdutos) return;
        const newRow = document.createElement('div');
        newRow.className = 'produto-row';
        newRow.innerHTML = `
            <select name="produto[]" required style="width: 370px;">
                <option value="">Selecione um produto</option>
                <option value="notebook">Notebook</option>
                <option value="projetor">Projetor</option>
                <option value="tablet">Tablet</option>
                <option value="impressora">Impressora</option>
            </select>
            <input type="number" name="quantidade[]" min="1" max="99" value="1" required style="width:30px;">
        `;
        addRemoveButton(newRow);
        produtosContainer.appendChild(newRow);
        if (produtosContainer.querySelectorAll('.produto-row').length >= maxProdutos) {
            addBtn.disabled = true;
        }
    });
</script>
</html>